name: Issue and PR Automation

on:
  issues:
    types: [opened, edited]
  pull_request:
    types: [opened, edited, ready_for_review]
  workflow_dispatch:

jobs:
  issue-pr-automation:
    name: Issue and PR Automation
    runs-on: self-hosted
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.x'
        
    - name: Install dependencies
      run: |
        pip install PyYAML requests
        
    - name: Validate issue template compliance
      if: github.event_name == 'issues'
      run: |
        echo "Validating issue template compliance..."
        
        # Check if issue follows template structure
        issue_body="${{ github.event.issue.body }}"
        issue_title="${{ github.event.issue.title }}"
        
        echo "Issue Title: $issue_title"
        
        # Check for required sections based on issue type
        if [[ "$issue_title" == *"[Design]"* ]]; then
          echo "Design issue detected"
          # Add design-specific validation here
        elif [[ "$issue_title" == *"[Research]"* ]]; then
          echo "Research issue detected"
          # Add research-specific validation here
        else
          echo "General issue - no specific template validation"
        fi
        
        echo "Issue validation completed"
        
    - name: Check PR compliance
      if: github.event_name == 'pull_request'
      run: |
        echo "Checking PR compliance..."
        
        pr_title="${{ github.event.pull_request.title }}"
        pr_body="${{ github.event.pull_request.body }}"
        
        echo "PR Title: $pr_title"
        
        # Check for proper PR title format
        if [[ ! "$pr_title" =~ ^(feat|fix|docs|style|refactor|test|chore): ]]; then
          echo "Warning: PR title should follow conventional commit format"
        fi
        
        # Check if PR has description
        if [ -z "$pr_body" ]; then
          echo "Warning: PR has no description"
        fi
        
        echo "PR compliance check completed"
        
    - name: Generate automation report
      run: |
        echo "## Automation Report" > automation_report.md
        echo "" >> automation_report.md
        echo "- ✅ Workflow executed successfully" >> automation_report.md
        echo "- 🔍 Template compliance checked" >> automation_report.md
        echo "- 📝 Content validation performed" >> automation_report.md
        echo "" >> automation_report.md
        echo "_Generated by self-hosted runner automation_" >> automation_report.md
        
        cat automation_report.md